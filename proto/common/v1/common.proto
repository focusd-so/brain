syntax = "proto3";

package common;

option go_package = "github.com/focusd-so/brain/gen/common/v1;commonv1";

import "options/gorm.proto";

message User {
    option (gorm.opts) = {
        ormable: true,
    };

    int64 id = 1 [(gorm.field).tag = {primary_key: true, auto_increment: true}];
    string device_fingerprint_hash = 2 [(gorm.field).tag = {unique: true}];
    string role = 3 [(gorm.field).tag = {not_null: true, default: "anonymous"}];
    string os_info = 4;
    int64 created_at = 5 [(gorm.field).tag = {not_null: true}];
}

message Nonce {
    option (gorm.opts) = {
        ormable: true,
    };

    string nonce = 1 [(gorm.field).tag = {unique: true}];
    int64 created_at = 2 [(gorm.field).tag = {not_null: true}];
    int64 expires_at = 3 [(gorm.field).tag = {not_null: true}];
}

// PromptHistory caches AI prompt/response pairs for reuse
message PromptHistory {
    option (gorm.opts) = {
        ormable: true,
    };

    string prompt_hash = 1 [(gorm.field).tag = {primary_key: true}];
    string response_json = 2 [(gorm.field).tag = {not_null: true, type: "TEXT"}];
    int64 created_at = 3 [(gorm.field).tag = {not_null: true}];
    int64 expires_at = 4 [(gorm.field).tag = {not_null: true}];
}


message OAuth2Token {
    string access_token = 1;
    string token_type = 2;        // "Bearer"
    string refresh_token = 3;     // Empty if provider doesn't support rotation
    int64 expiry_unix = 4;        // When the access token dies
    
    // Extra fields some providers send (e.g. Slack Team ID, GitHub User ID)
    map<string, string> extra = 5; 
}